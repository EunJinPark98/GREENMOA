<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org"
    xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
    layout:decorate="~{fragment/main_layout}">
<head>
<meta charset="UTF-8">
<title></title>
</head>
<body>
    <th:block layout:fragment="content" style="height: 1000px;">
      <link rel="stylesheet" href="/css/main.css">


      <!-- 클래스룸 -->
      <div id="classRoom">
        <div class="row" style="height: 100%;">
          <div class="col">
            <!-- 선생님 미니미 -->
            <div class="teacher">
              <img th:src="|/images/${teacher.minime}.png|">
              <p class="name">[[${teacher.memberName}]]</p>
            </div>
            <!-- 출석부 -->
            <div class="student-list" data-bs-toggle="modal" data-bs-target="#stuListModal"><img src="/images/studentList.png" alt=""></div>
            <!-- 학생 미니미 -->


            <div class="mini-fr">
              <th:block th:if="${memberList != null}">
                  <th:block th:each="member : ${memberList}">
                      <div class="member">
                          <!-- 미니미 말풍선 -->
                          <div class="minmeBubble" th:if="${session.loginInfo != null}">
                            <p class="letterText" data-bs-toggle="modal" th:attr="data-membername=${member.memberName}">쪽지보내기</p>
                          </div>
                          <div class="minmeBubble" th:unless="${session.loginInfo != null}">
                            <p class="letterText">로그인 하세요.</p>
                          </div>
                          <!-- 미니미 -->
                          <img class="minime-img" th:src="|/images/${member.minime}.png|">
                          <input type="hidden" id="memberName" name="memberName" th:value="${member.memberName}">
                          <p class="name">[[${member.memberName}]]</p>
                      </div>
                      
                      <!-- 쪽지 보내기 모달창 -->
                      <div class="modal fade" id="letterModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
                      aria-labelledby="staticBackdropLabel" aria-hidden="true">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-body modal-body">
                                  <div class="letter">
                                    <h3>[[${member.memberName}]]에게 쪽지보내기</h3>
                                    <form action="/room/insertLetter" method="post">
                                      <div th:if="${session.loginInfo != null}">
                                        <div>
                                          <input type="hidden" id="memberId" th:value="${loginInfo.memberId}">
                                        </div>
                                      </div>
                                      <div th:unless="${session.loginInfo != null}">
                                        
                                      </div>
                                      <div>
                                          <!-- <label for="memberName">받는 사람</label> -->
                                          <input type="hidden" id="memberName" name="memberName" th:value="${member.memberName}">
                                      </div>
                                      <div>
                                          <label for="letterContet">메세지</label>
                                          <textarea id="letterContet" name="letterContent"></textarea>
                                      </div>
                                      <ul>
                                          <li><input type="submit" class="btn btn-primary" value="보내기"></li>
                                          <li><button type="button" class="btn btn-secondary" onclick="closeLetterBox()">닫기</button></li>
                                      </ul>
                                    </form>
                                </div>
                                </div>
                            </div>
                        </div>
                      </div>

                  </th:block>
              </th:block>
            </div>
            

            <!-- 과제 -->
            <div class="work-icon" data-bs-toggle="modal" data-bs-target="#workModal">과제</div>
            <div class="work-btn bounce" data-bs-toggle="modal" data-bs-target="#workModal">과제</div>

            <!-- 캘린더 -->
            <div class="pin">핀셋</div>
            <a id="openCalender" class="calendar" data-bs-toggle="modal" data-bs-target="#calenderModal">캘린더</a>
          </div>
        </div>
      </div>

      
      

      <!-- 채팅 -->
          <div class="chatting-fr">
            <th:block th:if="${session.loginInfo}!=null">
              <input id="sender" type="hidden" th:attr="data-sender=${session.loginInfo.memberName}">
            </th:block>
            <div id="chat" class="container-md">
                <h3>채팅</h3>
                <div id="chat-messages"></div>
                <form id="message-form">
                    <input type="text" id="message" class="form-control">
                    <button type="submit" id="chatBtn" class="btn btn-primary">전송</button>
                </form>
            </div>
          </div>

     



        <!-- 출석부 모달 -->
        <div class="modal fade" id="stuListModal" tabindex="-1" aria-labelledby="stuListModalLabel" aria-hidden="true">
        <div class="modal-dialog">
          <div class="stu-modal-content modal-content">
            <div class="stu-modal-header modal-header">
              <h1 class="modal-title fs-5" id="stuListModalLabel">출석부</h1>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <img class="stu-list-pen" src="/images/black_pen.png" alt="">

              <th:block th:if="${memberList} != null">
                  <table class="table">
                    <thead class="stu-thead">
                      <tr>
                        <th scope="col">no</th>
                        <th scope="col">아이디</th>
                        <th scope="col">이름</th>
                        <th scope="col">성별</th>
                        <th scope="col">생년월일</th>
                      </tr>
                    </thead>
                    <tbody class="stu-tbody table-group-divider" th:each="member, state : ${memberList}">
                      <tr>
                        <td>[[${state.index + 1}]]</td>
                        <td>[[${member.memberId}]]</td>
                        <td>[[${member.memberName}]]</td>
                        <td>[[${member.memberGender}]]</td>
                        <td>[[${member.memberBirthday}]]</td>
                      </tr>
                    </tbody>
                  </table>
              </th:block>
            </div>
          </div>
        </div>
      </div>


      <!-- 과제 모달 -->
      <div class="modal fade" id="workModal" tabindex="-1" aria-labelledby="workModalLabel" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h1 class="modal-title fs-5" id="workModalLabel">과제</h1>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              과제리스트
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">닫기</button>
              <th:block th:if="${session.loginInfo != null && session.loginInfo.memberRoll == 'ADMIN'}">
                <button type="button" class="btn btn-primary">과제 등록</button>
              </th:block>
            </div>
          </div>
        </div>
      </div>


    <!-- 캘린더 모달 -->
    <div class="modal fade" id="calenderModal" tabindex="-1" aria-labelledby="calenderModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-xl">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <div id="calendar"></div>

            <form id="eventForm">
              <label for="calTitle">일정 제목:</label>
              <input type="text" id="calTitle" name="calTitle" required>
              <label for="calDate">일정 날짜:</label>
              <input type="date" id="calDate" name="calDate" required>
              <button type="submit">등록</button>
            </form>

          </div>
        </div>
      </div>
    </div>



    


      
      
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
        <script src="/js/room.js"></script>
        <!-- WebSocket 채팅 -->
        <script src="/webjars/sockjs-client/1.1.2/sockjs.min.js"></script>
        <!-- 풀 캘린더 -->
        <link href="https://cdn.jsdelivr.net/npm/fullcalendar@5.10.0/main.css" rel="stylesheet">
        <script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.10.0/main.js"></script>
    </th:block>
</body>
</html>